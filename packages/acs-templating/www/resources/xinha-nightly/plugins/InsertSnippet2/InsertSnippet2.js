/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* This file is part of version 0.96beta2 released Fri, 20 Mar 2009 11:01:14 +0100 */
function InsertSnippet2(c){this.editor=c;var a=c.config;var b=this;a.registerButton({id:"InsertSnippet2",tooltip:this._lc("Insert Snippet"),image:c.imgURL("ed_snippet.gif","InsertSnippet2"),textMode:false,action:function(d){b.buttonPress(d)}});a.addToolbarElement("InsertSnippet2","insertimage",-1);this.snippets=null;this.categories=null;this.html=null;Xinha._getback(a.InsertSnippet2.snippets,function(f,l){var g=l.responseXML;var k=g.getElementsByTagName("c");b.categories=[];for(var e=0;e<k.length;e++){b.categories.push(k[e].getAttribute("n"))}var n=g.getElementsByTagName("s");b.snippets=[];var h,m;for(var e=0;e<n.length;e++){m={};for(var d=0;d<n[e].attributes.length;d++){m[n[e].attributes[d].nodeName]=n[e].attributes[d].nodeValue}m.html=n[e].text||n[e].textContent;b.snippets.push(m)}});Xinha.loadStyle("InsertSnippet.css","InsertSnippet2","IScss")}InsertSnippet2.prototype.onUpdateToolbar=function(){if(!this.snippets){this.editor._toolbarObjects.InsertSnippet2.state("enabled",false)}else{InsertSnippet2.prototype.onUpdateToolbar=null}};InsertSnippet2._pluginInfo={name:"InsertSnippet2",version:"1.2",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};Xinha.Config.prototype.InsertSnippet2={snippets:Xinha.getPluginDir("InsertSnippet2")+"/snippets.xml"};InsertSnippet2.prototype._lc=function(a){return Xinha._lc(a,"InsertSnippet2")};InsertSnippet2.prototype.onGenerateOnce=function(){this._prepareDialog()};InsertSnippet2.prototype._prepareDialog=function(){var c=this;if(!this.html){Xinha._getback(Xinha.getPluginDir("InsertSnippet2")+"/dialog.html",function(g){c.html=g;c._prepareDialog()});return}if(!this.snippets){setTimeout(function(){c._prepareDialog()},50);return}var f=this.editor;var e=this;this.dialog=new Xinha.Dialog(f,this.html,"InsertSnippet2",{width:800,height:400},{modal:true});Xinha._addClass(this.dialog.rootElem,"InsertSnippet2");var d=this.dialog;var a=this.dialog.main;var b=this.dialog.captionBar;this.snippetTable=d.getElementById("snippettable");this.drawCatTabs();this.drawSnippetTable();this.preparePreview();d.onresize=function(){c.resize()};this.dialog.getElementById("search").onkeyup=function(){c.search()};this.dialog.getElementById("wordbegin").onclick=function(){c.search()};this.dialog.getElementById("cancel").onclick=function(){c.dialog.hide()}};InsertSnippet2.prototype.drawSnippetTable=function(){if(!this.snippets.length){return}var o=this;var g=this.snippetTable;var n=this.snippets;while(g.hasChildNodes()){g.removeChild(g.lastChild)}var a,k,d,l,c,j,f,m,b;for(var e=0,h=0;e<n.length;e++){a=e;k=n[e]["n"];l=n[e]["c"];c=n[e]["v"];d=n[e]["html"];if(this.categoryFilter&&l!=this.categoryFilter&&this.categoryFilter!="all"){continue}j=g.insertRow(h);h++;m=0;f=j.insertCell(m);f.onmouseover=function(i){return o.preview(i||window.event)};f.onmouseout=function(){return o.preview()};f.appendChild(document.createTextNode(k));f.snID=a;f.id="cell"+a;m++;f=j.insertCell(m);f.style.whiteSpace="nowrap";b=document.createElement("button");b.snID=a;b._insAs="html";b.onclick=function(i){o.doInsert(i||window.event);return false};b.appendChild(document.createTextNode(this._lc("HTML")));b.title=this._lc("Insert as HTML");f.appendChild(b);if(c){f.appendChild(document.createTextNode(" "));var b=document.createElement("button");b.snID=a;b._insAs="variable";b.onclick=function(i){o.doInsert(i||window.event);return false};b.appendChild(document.createTextNode(this._lc("Variable")));b.title=this._lc("Insert as template variable");f.appendChild(b)}m++}};InsertSnippet2.prototype.drawCatTabs=function(){if(!this.categories.length){return}var b=this;var a=this.dialog.getElementById("cattabs");while(a.hasChildNodes()){a.removeChild(a.lastChild)}var f=1;var e=document.createElement("a");e.href="javascript:void(0);";e.appendChild(document.createTextNode(this._lc("All Categories")));e.cat="all";e.className="tab"+f;e.onclick=function(){b.categoryFilter=b.cat;b.drawCatTabs();b.drawSnippetTable();b.search()};if(!this.categoryFilter||this.categoryFilter=="all"){Xinha._addClass(e,"active");e.onclick=null}a.appendChild(e);f++;for(var d=0;d<this.categories.length;d++){var c=this.categories[d];var e=document.createElement("a");e.href="javascript:void(0);";e.appendChild(document.createTextNode(c));e.cat=c;e.className="tab"+f;e.onclick=function(){b.categoryFilter=this.cat;b.drawCatTabs();b.drawSnippetTable();b.search()};if(c==this.categoryFilter){Xinha._addClass(e,"active");e.onclick=null}a.appendChild(e);if(Xinha.is_gecko){a.appendChild(document.createTextNode(String.fromCharCode(8203)))}f=(f<16)?f+1:1}if(!this.catTabsH){this.catTabsH=a.offsetHeight}};InsertSnippet2.prototype.search=function(){var f=this.dialog.getElementById("snippettable");var k=this.dialog.getElementById("search");if(k.value){var b=k.value;b=b.replace(/\.?([*?+])/g,".$1");var c=(this.dialog.getElementById("wordbegin").checked)?"^":"";try{var j=new RegExp(c+b,"i")}catch(g){var j=null}}else{var j=null}for(var d=0;d<f.childNodes.length;d++){var h=f.childNodes[d];var a=h.firstChild.firstChild.data;if(j&&!a.match(j)){h.style.display="none"}else{h.style.display=""}}};InsertSnippet2.prototype.preview=function(a){if(!a){this.previewBody.innerHTML="";return}var c=a.target||a.srcElement;var b=c.snID;if(!this.previewBody){this.preparePreview();return}if(this.previewIframe.style.display=="none"){this.previewIframe.style.display="block"}this.previewBody.innerHTML=this.snippets[b].html};InsertSnippet2.prototype.preparePreview=function(){var e=this.editor;var a=this;var g=this.previewIframe=this.dialog.getElementById("preview_iframe");var f=null;try{if(g.contentDocument){f=g.contentDocument}else{f=g.contentWindow.document}if(!f){if(Xinha.is_gecko){setTimeout(function(){a.preparePreview(snID)},50);return false}else{throw ("ERROR: IFRAME can't be initialized.")}}}catch(d){setTimeout(function(){a.preparePreview(snID)},50)}f.open("text/html","replace");var c="<html><head><title></title>";c+='<meta http-equiv="Content-Type" content="text/html; charset='+e.config.charSet+'">\n';c+='<style type="text/css">body {background-color:#fff} </style>';if(typeof e.config.baseHref!="undefined"&&e.config.baseHref!==null){c+='<base href="'+e.config.baseHref+'"/>\n'}if(e.config.pageStyle){c+='<style type="text/css">\n'+e.config.pageStyle+"\n</style>"}if(typeof e.config.pageStyleSheets!=="undefined"){for(var b=0;b<e.config.pageStyleSheets.length;b++){if(e.config.pageStyleSheets[b].length>0){c+='<link rel="stylesheet" type="text/css" href="'+e.config.pageStyleSheets[b]+'">'}}}c+="</head>\n";c+="<body>\n";c+="</body>\n";c+="</html>";f.write(c);f.close();setTimeout(function(){a.previewBody=f.getElementsByTagName("body")[0]},100)};InsertSnippet2.prototype.buttonPress=function(a){this.dialog.toggle()};InsertSnippet2.prototype.doInsert=function(b){var c=b.target||b.srcElement;var d=this.snippets[c.snID];this.dialog.hide();var a=this.editor.config.InsertSnippet2;if(c._insAs=="variable"){this.editor.insertHTML(d.v)}else{this.editor.insertHTML(d.html)}};InsertSnippet2.prototype.resize=function(){var a=this.dialog.getElementById("insert_div");var d=this.dialog.getElementById("preview_iframe");var c={h:this.dialog.height,w:this.dialog.width};var b=c.h-90;if(this.categories.length){b-=this.catTabsH}a.style.height=d.style.height=b+"px";return true};