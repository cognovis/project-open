/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* This file is part of version 0.96beta2 released Fri, 20 Mar 2009 11:01:14 +0100 */
Xinha.Config.prototype.css_style={};Xinha.Config.prototype.stylistLoadStylesheet=function(a,d){if(!d){d={}}var c=Xinha.ripStylesFromCSSFile(a);for(var b in c){if(d[b]){this.css_style[b]=d[b]}else{this.css_style[b]=c[b]}}this.pageStyleSheets[this.pageStyleSheets.length]=a};Xinha.Config.prototype.stylistLoadStyles=function(b,d){if(!d){d={}}var c=Xinha.ripStylesFromCSSString(b);for(var a in c){if(d[a]){this.css_style[a]=d[a]}else{this.css_style[a]=c[a]}}this.pageStyle+=b};Xinha.prototype._fillStylist=function(){if(!this.plugins.Stylist.instance.dialog){return false}var c=this.plugins.Stylist.instance.dialog.main;c.innerHTML="";var f=true;var a=this._getSelection();var i=this._activeElement(a);for(var l in this.config.css_style){var m=null;var k=l.trim();var d=true;var b=i;if(d&&/[^a-zA-Z0-9_.-]/.test(k)){d=false}if(k.indexOf(".")<0){d=false}if(d&&(k.indexOf(".")>0)){m=k.substring(0,k.indexOf(".")).toLowerCase();k=k.substring(k.indexOf("."),k.length);if(i!=null&&i.tagName.toLowerCase()==m){d=true;b=i}else{if(this._getFirstAncestor(this._getSelection(),[m])!=null){d=true;b=this._getFirstAncestor(this._getSelection(),[m])}else{if((m=="div"||m=="span"||m=="p"||(m.substr(0,1)=="h"&&m.length==2&&m!="hr"))){if(!this._selectionEmpty(this._getSelection())){d=true;b="new"}else{b=this._getFirstAncestor(a,["p","h1","h2","h3","h4","h5","h6","h7"]);if(b!=null){d=true}else{d=false}}}else{d=false}}}}if(d){k=k.substring(k.indexOf("."),k.length);k=k.replace("."," ");if(b==null){if(this._selectionEmpty(this._getSelection())){b=this._getFirstAncestor(this._getSelection(),null)}else{b="new";m="span"}}}var e=(this._ancestorsWithClasses(a,m,k).length>0?true:false);var g=this._ancestorsWithClasses(a,m,k);if(d){var j=document.createElement("a");j.onfocus=function(){this.blur()};j._stylist_className=k.trim();j._stylist_applied=e;j._stylist_appliedTo=g;j._stylist_applyTo=b;j._stylist_applyTag=m;j.innerHTML=this.config.css_style[l];j.href="javascript:void(0)";var h=this;j.onclick=function(){if(this._stylist_applied==true){h._stylistRemoveClasses(this._stylist_className,this._stylist_appliedTo)}else{h._stylistAddClasses(this._stylist_applyTo,this._stylist_applyTag,this._stylist_className)}return false};j.style.display="block";j.style.paddingLeft="3px";j.style.paddingTop="1px";j.style.paddingBottom="1px";j.style.textDecoration="none";if(e){j.style.background="Highlight";j.style.color="HighlightText"}c.appendChild(j)}}};Xinha.prototype._stylistAddClasses=function(c,a,b){if(c=="new"){this.insertHTML("<"+a+' class="'+b+'">'+this.getSelectedHTML()+"</"+a+">")}else{if(a!=null&&c.tagName.toLowerCase()!=a){var d=this.switchElementTag(c,a);if(typeof c._stylist_usedToBe!="undefined"){d._stylist_usedToBe=c._stylist_usedToBe;d._stylist_usedToBe[d._stylist_usedToBe.length]={tagName:c.tagName,className:c.getAttribute("class")}}else{d._stylist_usedToBe=[{tagName:c.tagName,className:c.getAttribute("class")}]}Xinha.addClasses(d,b)}else{Xinha._addClasses(c,b)}}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClasses=function(b,c){for(var a=0;a<c.length;a++){this._stylistRemoveClassesFull(c[a],b)}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClassesFull=function(a,c){if(a!=null){var f=a.className.trim().split(" ");var g=[];var m=c.split(" ");for(var j=0;j<f.length;j++){var l=false;for(var e=0;l==false&&e<m.length;e++){if(m[e]==f[j]){l=true}}if(l==false){g[g.length]=f[j]}}if(g.length==0&&a._stylist_usedToBe&&a._stylist_usedToBe.length>0&&a._stylist_usedToBe[a._stylist_usedToBe.length-1].className!=null){var h=a._stylist_usedToBe[a._stylist_usedToBe.length-1];var k=Xinha.arrayFilter(h.className.trim().split(" "),function(i){if(i==null||i.trim()==""){return false}return true});if((g.length==0)||(Xinha.arrayContainsArray(g,k)&&Xinha.arrayContainsArray(k,g))){a=this.switchElementTag(a,h.tagName);g=k}else{a._stylist_usedToBe=[]}}if(g.length>0||a.tagName.toLowerCase()!="span"||(a.id&&a.id!="")){a.className=g.join(" ").trim()}else{var b=a.parentNode;var d;while(a.hasChildNodes()){if(a.firstChild.nodeType==1){this._stylistRemoveClassesFull(a.firstChild,c)}d=a.removeChild(a.firstChild);b.insertBefore(d,a)}b.removeChild(a)}}};Xinha.prototype.switchElementTag=function(d,b){var c=d.parentNode;var f=this._doc.createElement(b);if(Xinha.is_ie||d.hasAttribute("id")){f.setAttribute("id",d.getAttribute("id"))}if(Xinha.is_ie||d.hasAttribute("style")){f.setAttribute("style",d.getAttribute("style"))}var e=d.childNodes;for(var a=0;a<e.length;a++){f.appendChild(e[a].cloneNode(true))}c.insertBefore(f,d);f._stylist_usedToBe=[d.tagName];c.removeChild(d);this.selectNodeContents(f);return f};Xinha.prototype._getAncestorsClassNames=function(d){var c=this._activeElement(d);if(c==null){c=(Xinha.is_ie?this._createRange(d).parentElement():this._createRange(d).commonAncestorContainer)}var e=[];while(c){if(c.nodeType==1){var b=c.className.trim().split(" ");for(var a=0;a<b.length;a++){e[e.length]=b[a]}if(c.tagName.toLowerCase()=="body"){break}if(c.tagName.toLowerCase()=="table"){break}}c=c.parentNode}return e};Xinha.prototype._ancestorsWithClasses=function(a,m,c){var l=[];var b=this._activeElement(a);if(b==null){try{b=(Xinha.is_ie?this._createRange(a).parentElement():this._createRange(a).commonAncestorContainer)}catch(h){return l}}var g=c.trim().split(" ");while(b){if(b.nodeType==1&&b.className){if(m==null||b.tagName.toLowerCase()==m){var c=b.className.trim().split(" ");var k=true;for(var f=0;f<g.length;f++){var d=false;for(var j=0;j<c.length;j++){if(g[f]==c[j]){d=true;break}}if(!d){k=false;break}}if(k){l[l.length]=b}}if(b.tagName.toLowerCase()=="body"){break}if(b.tagName.toLowerCase()=="table"){break}}b=b.parentNode}return l};Xinha.ripStylesFromCSSFile=function(g){var f=Xinha._geturlcontent(g);var e="@import\\s*(url\\()?[\"'](.*)[\"'].*";var a=f.match(new RegExp(e,"ig"));var c,b,h=new RegExp(e,"i");if(a){var j=g.replace(/\?.*$/,"").split("/");j.pop();j=j.join("/");for(var d=0;d<a.length;d++){c=a[d].match(h);b=c[2];if(!b.match(/^([^:]+\:)?\//)){b=Xinha._resolveRelativeUrl(j,b)}f+=Xinha._geturlcontent(b)}}return Xinha.ripStylesFromCSSString(f)};Xinha.ripStylesFromCSSString=function(e){var d=/\/\*(.|\r|\n)*?\*\//g;var c=/\{(.|\r|\n)*?\}/g;e=e.replace(d,"");e=e.replace(c,",");e=e.split(",");var b={};for(var a=0;a<e.length;a++){if(e[a].trim()){b[e[a].trim()]=e[a].trim()}}return b};function Stylist(b,a){this.editor=b;var c=this}Stylist._pluginInfo={name:"Stylist",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"HTMLArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};Stylist.prototype.onGenerateOnce=function(){var a=this.editor.config;if(typeof a.css_style!="undefined"&&Xinha.objectProperties(a.css_style).length!=0){this._prepareDialog()}};Stylist.prototype._prepareDialog=function(){var e=this.editor;var f=this;var d="<h1><l10n>Styles</l10n></h1>";this.dialog=new Xinha.Dialog(e,d,"Stylist",{width:200},{modal:false,closable:false});Xinha._addClass(this.dialog.rootElem,"Stylist");this.dialog.attachToPanel("right");this.dialog.show();var c=this.dialog;var a=this.dialog.main;var b=this.dialog.captionBar;a.style.overflow="auto";a.style.height=this.editor._framework.ed_cell.offsetHeight-b.offsetHeight+"px";e.notifyOn("modechange",function(h,g){if(!c.attached){return}switch(g.mode){case"text":c.hide();break;case"wysiwyg":c.show();break}});e.notifyOn("panel_change",function(i,h){if(!c.attached){return}switch(h.action){case"show":var g=a.offsetHeight-h.panel.offsetHeight;a.style.height=((g>0)?a.offsetHeight-h.panel.offsetHeight:0)+"px";c.rootElem.style.height=b.offsetHeight+"px";e.sizeEditor();break;case"hide":f.resize();break}});e.notifyOn("before_resize",function(){if(!c.attached){return}c.rootElem.style.height=b.offsetHeight+"px"});e.notifyOn("resize",function(){if(!c.attached){return}f.resize()})};Stylist.prototype.resize=function(){var e=this.editor;var b=this.dialog.rootElem;if(b.style.display=="none"){return}var d=b.parentNode;var a=d.offsetHeight;for(var c=0;c<d.childNodes.length;++c){if(d.childNodes[c]==b||!d.childNodes[c].offsetHeight){continue}a-=d.childNodes[c].offsetHeight}b.style.height=a-5+"px";this.dialog.main.style.height=a-this.dialog.captionBar.offsetHeight-5+"px"};Stylist.prototype.onUpdateToolbar=function(){if(this.dialog){if(this._timeoutID){window.clearTimeout(this._timeoutID)}var a=this.editor;this._timeoutID=window.setTimeout(function(){a._fillStylist()},250)}};