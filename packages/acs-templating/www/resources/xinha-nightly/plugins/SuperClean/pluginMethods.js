/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* This file is part of version 0.96beta2 released Fri, 20 Mar 2009 11:01:14 +0100 */
SuperClean.prototype._superClean=function(opts,obj){if(this.editor.config.SuperClean.show_dialog&&!this._dialog){this._dialog=new SuperClean.Dialog(this)}var superclean=this;var doOK=function(){superclean._dialog.dialog.getElementById("main").style.display="none";superclean._dialog.dialog.getElementById("waiting").style.display="";superclean._dialog.dialog.getElementById("buttons").style.display="none";var opts=superclean._dialog.dialog.getValues();var editor=superclean.editor;if(opts.word_clean){editor._wordClean()}var D=editor.getEditorContent();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"||filter=="word_clean"){continue}if(opts[filter]){D=SuperClean.filterFunctions[filter](D,editor)}}D=D.replace(/(style|class)="\s*"/gi,"");D=D.replace(/<(font|span)\s*>/gi,"");editor.setEditorContent(D);if(opts.tidy){var callback=function(javascriptResponse){eval("var response = "+javascriptResponse);switch(response.action){case"setHTML":editor.setEditorContent(response.value);superclean._dialog.hide();break;case"alert":superclean._dialog.dialog.getElementById("buttons").style.display="";superclean._dialog.dialog.getElementById("ok").style.display="none";superclean._dialog.dialog.getElementById("waiting").style.display="none";superclean._dialog.dialog.getElementById("alert").style.display="";superclean._dialog.dialog.getElementById("alert").innerHTML=superclean._lc(response.value);break;default:superclean._dialog.hide();break}};Xinha._postback(editor.config.SuperClean.tidy_handler,{content:editor.getInnerHTML()},callback)}else{superclean._dialog.hide()}return true};if(this.editor.config.SuperClean.show_dialog){var inputs={};this._dialog.show(inputs,doOK)}else{var editor=this.editor;var html=editor.getEditorContent();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"){continue}html=SuperClean.filterFunctions[filter](html,editor)}html=html.replace(/(style|class)="\s*"/gi,"");html=html.replace(/<(font|span)\s*>/gi,"");editor.setEditorContent(html);if(editor.config.SuperClean.filters.tidy){SuperClean.filterFunctions.tidy(html,editor)}}};SuperClean.filterFunctions.remove_colors=function(a){a=a.replace(/color="?[^" >]*"?/gi,"");a=a.replace(/([^-])color:[^;}"']+;?/gi,"$1");return(a)};SuperClean.filterFunctions.remove_sizes=function(a){a=a.replace(/size="?[^" >]*"?/gi,"");a=a.replace(/font-size:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_faces=function(a){a=a.replace(/face="?[^" >]*"?/gi,"");a=a.replace(/font-family:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_lang=function(a){a=a.replace(/lang="?[^" >]*"?/gi,"");return(a)};SuperClean.filterFunctions.word_clean=function(a,b){b.setHTML(a);b._wordClean();return b.getInnerHTML()};SuperClean.filterFunctions.remove_fancy_quotes=function(a){a=a.replace(new RegExp(String.fromCharCode(8216),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8217),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8218),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8219),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8220),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8221),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8222),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8223),"g"),'"');return a};SuperClean.filterFunctions.tidy=function(html,editor){var callback=function(javascriptResponse){eval("var response = "+javascriptResponse);switch(response.action){case"setHTML":editor.setEditorContent(response.value);break;case"alert":alert(Xinha._lc(response.value,"SuperClean"));break}};Xinha._postback(editor.config.SuperClean.tidy_handler,{content:html},callback)};SuperClean.Dialog=function(a){var b=this;this.Dialog_nxtid=0;this.SuperClean=a;this.id={};this.ready=false;this.dialog=false;this._prepareDialog()};SuperClean.Dialog.prototype._prepareDialog=function(){var g=this;var e=this.SuperClean;var c=window.SuperClean.html;var f="";for(var d in this.SuperClean.editor.config.SuperClean.filters){f+="    <div>\n";var b=this.SuperClean.editor.config.SuperClean.filters[d];if(typeof b.label=="undefined"){f+='        <input type="checkbox" name="['+d+']" id="['+d+']" checked value="on" />\n';f+='        <label for="['+d+']">'+this.SuperClean.editor.config.SuperClean.filters[d]+"</label>\n"}else{f+='        <input type="checkbox" name="['+d+']" id="['+d+']" value="on"'+(b.checked?"checked":"")+" />\n";f+='        <label for="['+d+']">'+b.label+"</label>\n"}f+="    </div>\n"}c=c.replace("<!--filters-->",f);var a=this.dialog=new Xinha.Dialog(e.editor,c,"SuperClean",{width:400});this.ready=true};SuperClean.Dialog.prototype._lc=SuperClean.prototype._lc;SuperClean.Dialog.prototype.show=function(a,c,d){if(!this.ready){var e=this;window.setTimeout(function(){e.show(a,c,d)},100);return}var b=this.dialog;var e=this;if(c){this.dialog.getElementById("ok").onclick=c}else{this.dialog.getElementById("ok").onclick=function(){e.hide()}}if(d){this.dialog.getElementById("cancel").onclick=d}else{this.dialog.getElementById("cancel").onclick=function(){e.hide()}}this.SuperClean.editor.disableToolbar(["fullscreen","SuperClean"]);this.dialog.show(a);this.dialog.onresize()};SuperClean.Dialog.prototype.hide=function(){var a=this.dialog.hide();this.SuperClean.editor.enableToolbar();this.dialog.getElementById("main").style.display="";this.dialog.getElementById("buttons").style.display="";this.dialog.getElementById("waiting").style.display="none";this.dialog.getElementById("alert").style.display="none";this.dialog.getElementById("ok").style.display="";return a};