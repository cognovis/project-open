/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* This file is part of version 0.96beta2 released Fri, 20 Mar 2009 11:01:14 +0100 */
function comboSelectValue(f,d){var b=f.getElementsByTagName("option");for(var a=b.length;--a>=0;){var e=b[a];e.selected=(e.value==d)}f.value=d}function i18n(a){return Xinha._lc(a,"ExtendedFileManager")}function setAlign(c){var b=document.getElementById("f_align");for(var a=0;a<b.length;a++){if(b.options[a].value==c){b.selectedIndex=a;break}}}function onTargetChanged(){var a=document.getElementById("f_other_target");if(this.value=="_other"){a.style.visibility="visible";a.select();a.focus()}else{a.style.visibility="hidden"}}function init(){if(typeof imgManager=="undefined"){setTimeout(init,10);return}var r=650;var A=600;window.resizeTo(r,A);var f=Xinha.pageSize(window);window.resizeTo(r,A);var v=Xinha.viewportSize(window);window.resizeBy(0,f.y-v.y+5);v=Xinha.viewportSize(window);if(!Xinha.is_ie){var q=opener.screenX+(opener.outerWidth-v.x)/2;var o=opener.screenY+(opener.outerHeight-v.x)/2}else{var q=(self.screen.availWidth-v.x)/2;var o=(self.screen.availHeight-v.y)/2}window.moveTo(q,o);__xinha_dlg_init();__dlg_translate("ExtendedFileManager");var m=document.getElementById("uploadForm");if(m){m.target="imgManager"}var d=window.dialogArguments.editor;var g=window.dialogArguments.param;var k=null;if(manager_mode=="image"&&g){var n=new RegExp("^https?://");if(g.f_url.length>0&&!n.test(g.f_url)&&typeof g.baseHref=="string"){g.f_url=g.baseHref+g.f_url}var t=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));g.f_url=g.f_url.replace(t,"");var u=(_resized_dir)?_resized_dir.replace(Xinha.RE_Specials,"\\$1")+"/":"";var p=_resized_prefix.replace(Xinha.RE_Specials,"\\$1");var c=new RegExp("^(.*/)"+u+p+"_([0-9]+)x([0-9]+)_([^/]+)$");var l=g.f_url.match(c);if(c.test(g.f_url)){g.f_url=RegExp.$1+RegExp.$4;g.f_width=RegExp.$2;g.f_height=RegExp.$3}document.getElementById("f_url").value=g.f_url;document.getElementById("f_alt").value=g.f_alt;document.getElementById("f_title").value=g.f_title;document.getElementById("f_border").value=g.f_border;document.getElementById("f_width").value=g.f_width;document.getElementById("f_height").value=g.f_height;document.getElementById("f_margin").value=g.f_margin;document.getElementById("f_padding").value=g.f_padding;document.getElementById("f_borderColor").value=g.f_borderColor;document.getElementById("f_backgroundColor").value=g.f_backgroundColor;setAlign(g.f_align);document.getElementById("f_url").focus();document.getElementById("orginal_width").value=g.f_width;document.getElementById("orginal_height").value=g.f_height;var c=new RegExp("^(.*/)([^/]+)$");if(c.test(g.f_url)){k=RegExp.$1}document.getElementById("f_preview").src=_backend_url+"__function=thumbs&img="+g.f_url}else{if(manager_mode=="link"&&g){var e=document.getElementById("f_target");var n=new RegExp("^https?://");if(g.f_href.length>0&&!n.test(g.f_href)&&typeof g.baseHref=="string"){g.f_href=g.baseHref+g.f_href}var s=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));g.f_href=g.f_href.replace(s,"");var c=new RegExp("^(.*/)([^/]+)$");if(c.test(g.f_href)){k=RegExp.$1}else{k=document.cookie.match(/EFMStartDirlink=(.*?)(;|$)/);if(k){k=k[1]}}if(g){if(typeof g.f_href!="undefined"){document.getElementById("f_href").value=g.f_href;document.getElementById("f_title").value=g.f_title;comboSelectValue(e,g.f_target);if(e.value!=g.f_target){var a=document.createElement("option");a.value=g.f_target;a.innerHTML=a.value;e.appendChild(a);a.selected=true}}}if(g.f_usetarget==false||manager_show_target!=false){document.getElementById("f_target_label").style.visibility="hidden";document.getElementById("f_target").style.visibility="hidden";document.getElementById("f_other_target").style.visibility="hidden"}if(e&&g.f_usetarget&&manager_show_target!=false){var a=document.createElement("option");a.value="_other";a.innerHTML=i18n("Other");e.appendChild(a);e.onchange=onTargetChanged}document.getElementById("f_href").focus()}else{if(!g){k=document.cookie.match(new RegExp("EFMStartDir"+manager_mode+"=(.*?)(;|$)"));if(k){k=k[1]}}}}if(k){iframeUrl+="&dir="+k;var b=document.getElementById("dirPath");for(var z=0;z<b.options.length;z++){if(b.options[z].value==encodeURIComponent(k)){b.options[z].selected=true;break}}}imgManager.location.replace(iframeUrl);if(manager_mode=="image"&&typeof Xinha.colorPicker!="undefined"&&document.getElementById("f_backgroundColor")&&document.getElementById("f_backgroundColor").type=="text"){var j={cellsize:d.config.colorPickerCellSize,granularity:d.config.colorPickerGranularity,websafe:d.config.colorPickerWebSafe,savecolors:d.config.colorPickerSaveColors};new Xinha.colorPicker.InputBinding(document.getElementById("f_backgroundColor"),j);new Xinha.colorPicker.InputBinding(document.getElementById("f_borderColor"),j)}setTimeout(function(){resize();addEvent(window,"resize",resize)},500)}function pasteButton(e){var d=document.getElementById("pasteBtn");if(!d.firstChild){var b=document.createElement("a");b.href="javascript:void(0);";var c=document.createElement("img");c.src=window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/img/edit_paste.gif";c.alt=i18n("Paste");b.appendChild(c);d.appendChild(b)}d.onclick=function(){if(typeof imgManager!="undefined"){imgManager.paste(e)}if(e.action=="moveFile"||e.action=="moveDir"){this.onclick=null;this.removeChild(this.firstChild)}};switch(e.action){case"copyFile":d.firstChild.title=i18n('Copy "$file='+e.file+'$" from "$dir='+decodeURIComponent(e.dir)+'$" here');break;case"copyDir":d.firstChild.title=i18n('Copy folder "$file='+e.file+'$" from "$dir='+decodeURIComponent(e.dir)+'$" here');break;case"moveFile":d.firstChild.title=i18n('Move "$file='+e.file+'$" from "$dir='+decodeURIComponent(e.dir)+'$" here');break;break;case"moveDir":d.firstChild.title=i18n('Move folder "$file='+e.file+'$" from "$dir='+decodeURIComponent(e.dir)+'$" here');break}}function onCancel(){__dlg_close(null);return false}function onOK(){if(manager_mode=="image"){var fields=["f_url","f_alt","f_title","f_align","f_border","f_margin","f_padding","f_height","f_width","f_borderColor","f_backgroundColor"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_url"&&el.value.indexOf("://")<0&&el.value){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}var origsize={w:document.getElementById("orginal_width").value,h:document.getElementById("orginal_height").value};if((origsize.w!=param.f_width)||(origsize.h!=param.f_height)){var resized=Xinha._geturlcontent(window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/"+_backend_url+"&__function=resizer&img="+encodeURIComponent(document.getElementById("f_url").value)+"&width="+param.f_width+"&height="+param.f_height);resized=eval(resized);if(resized){param.f_url=makeURL(base_url,resized)}}__dlg_close(param);return false}else{if(manager_mode=="link"){var required={};for(var i in required){var el=document.getElementById(i);if(!el.value){alert(required[i]);el.focus();return false}}var fields=["f_href","f_title","f_target"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_href"&&el.value.indexOf("://")<0){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}if(param.f_target=="_other"){param.f_target=document.getElementById("f_other_target").value}__dlg_close(param);return false}}}function makeURL(b,a){if(b.substring(b.length-1)!="/"){b+="/"}if(a.charAt(0)=="/"){}a=a.substring(1);return b+a}function updateDir(a){var b=a.options[a.selectedIndex].value;changeDir(b)}function goUpDir(){var d=document.getElementById("dirPath");var g=d.options[d.selectedIndex].text;if(g.length<2){return false}var f=g.split("/");var c="";for(var b=0;b<f.length-2;b++){c+=f[b]+"/"}for(var b=0;b<d.length;b++){var a=d.options[b].text;if(a==c){d.selectedIndex=b;var e=d.options[b].value;changeDir(e);break}}}function changeDir(a){if(typeof imgManager!="undefined"){imgManager.changeDir(a)}}function updateView(){refresh()}function toggleConstrains(b){var a=document.getElementById("imgLock");var b=document.getElementById("constrain_prop");if(b.checked){a.src="img/locked.gif";checkConstrains("width")}else{a.src="img/unlocked.gif"}}function checkConstrains(d){var c=document.getElementById("constrain_prop");if(c.checked){var e=document.getElementById("orginal_width");var b=parseInt(e.value);var e=document.getElementById("orginal_height");var f=parseInt(e.value);var g=document.getElementById("f_width");var h=document.getElementById("f_height");var a=parseInt(g.value);var i=parseInt(h.value);if(b>0&&f>0){if(d=="width"&&a>0){h.value=parseInt((a/b)*f)}if(d=="height"&&i>0){g.value=parseInt((i/f)*b)}}}}function showMessage(a){var c=document.getElementById("message");var b=document.getElementById("messages");if(c.firstChild){c.removeChild(c.firstChild)}c.appendChild(document.createTextNode(i18n(a)));b.style.display="block"}function addEvent(d,c,a){if(d.addEventListener){d.addEventListener(c,a,true);return true}else{if(d.attachEvent){var b=d.attachEvent("on"+c,a);return b}else{return false}}}function doUpload(){var a=document.getElementById("uploadForm");if(a){showMessage("Uploading")}}function refresh(){var a=document.getElementById("dirPath");updateDir(a)}function newFolder(){function a(e){var d=document.getElementById("dirPath");var c=d.options[d.selectedIndex].value;if(e==thumbdir){alert(i18n("Invalid folder name, please choose another folder name."));return false}if(e&&e!=""&&typeof imgManager!="undefined"){imgManager.newFolder(c,encodeURI(e))}}if(Xinha.ie_version>6){popupPrompt(i18n("Please enter name for new folder..."),i18n("Untitled"),a,i18n("New Folder"))}else{var b=prompt(i18n("Please enter name for new folder..."),i18n("Untitled"));a(b)}}function resize(){var c=Xinha.viewportSize(window);var a=document.getElementById("messages");var b=(a&&a.style.display!="none")?parseInt(document.getElementById("messages").offsetHeight,10):0;document.getElementById("imgManager").style.height=parseInt(c.y-130-document.getElementById("controls").offsetHeight,10)-b+"px";return true}Xinha.addOnloadHandler(init,window);