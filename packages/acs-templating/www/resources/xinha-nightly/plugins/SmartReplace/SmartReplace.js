/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
/* This file is part of version 0.96beta2 released Fri, 20 Mar 2009 11:01:14 +0100 */
function SmartReplace(c){this.editor=c;var a=c.config;var b=this;a.registerButton({id:"smartreplace",tooltip:this._lc("SmartReplace"),image:[_editor_url+"iconsets/Tango/ed_buttons_main.png",3,8],textMode:false,action:function(f,g,d){b.buttonPress(null,d)}});a.addToolbarElement("smartreplace","htmlmode",1)}SmartReplace._pluginInfo={name:"SmartReplace",version:"1.0",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SmartReplace.prototype._lc=function(a){return Xinha._lc(a,"SmartReplace")};Xinha.Config.prototype.SmartReplace={defaultActive:true,quotes:null};SmartReplace.prototype.toggleActivity=function(a){if(typeof a!="undefined"){this.active=a}else{this.active=this.active?false:true}this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onUpdateToolbar=function(){this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onGenerate=function(){this.active=this.editor.config.SmartReplace.defaultActive;this.editor._toolbarObjects.smartreplace.state("active",this.active);var b=this;Xinha._addEvent(b.editor._doc,"keypress",function(c){return b.keyEvent(Xinha.is_ie?b.editor._iframe.contentWindow.event:c)});var a=this.editor.config.SmartReplace.quotes;if(a&&typeof a=="object"){this.openingQuotes=a[0];this.closingQuotes=a[1];this.openingQuote=a[2];this.closingQuote=a[3]}else{this.openingQuotes=this._lc("OpeningDoubleQuotes");this.closingQuote=this._lc("ClosingSingleQuote");this.closingQuotes=this._lc("ClosingDoubleQuotes");this.openingQuote=this._lc("OpeningSingleQuote")}if(this.openingQuotes=="OpeningDoubleQuotes"){this.openingQuotes=String.fromCharCode(8220);this.closingQuotes=String.fromCharCode(8221);this.openingQuote=String.fromCharCode(8216);this.closingQuote=String.fromCharCode(8217)}};SmartReplace.prototype.keyEvent=function(d){if(!this.active){return true}var c=this.editor;var a=Xinha.is_ie?d.keyCode:d.which;var b=String.fromCharCode(a);if(b=='"'||b=="'"){Xinha._stopEvent(d);return this.smartQuotes(b)}if(a==32){return this.smartReplace(d,2,/^\s-/," "+String.fromCharCode(8211),false)}if(b=="."){return this.smartReplace(d,2,/\.\./,String.fromCharCode(8230),true)}return true};SmartReplace.prototype.smartQuotes=function(d){if(d=="'"){var a=this.openingQuote;var b=this.closingQuote}else{var a=this.openingQuotes;var b=this.closingQuotes}var c=this.editor;var f=c.getSelection();if(Xinha.is_ie){var e=c.createRange(f);if(e.text!==""){e.text=""}e.moveStart("character",-1);if(e.text.match(/\S/)){e.moveStart("character",+1);e.text=b}else{e.moveStart("character",+1);e.text=a}}else{var e=c.createRange(f);if(!e.collapsed){c.insertNodeAtSelection(document.createTextNode(""))}if(e.startOffset>0){e.setStart(e.startContainer,e.startOffset-1)}if(e.toString().match(/[^\s\xA0]/)){e.collapse(false);c.insertNodeAtSelection(document.createTextNode(b))}else{c.insertNodeAtSelection(document.createTextNode(a))}c.getSelection().collapseToEnd()}return false};SmartReplace.prototype.smartReplace=function(g,f,d,a,c){var b=this.editor;var h=this.editor.getSelection();var e=this.editor.createRange(h);if(Xinha.is_ie){e.moveStart("character",-f);if(e.text.match(d)){e.text=a;if(c){Xinha._stopEvent(g);return false}}}else{if(e.startOffset>1){e.setStart(e.startContainer,e.startOffset-f)}if(e.toString().match(d)){this.editor.insertNodeAtSelection(document.createTextNode(a));e.deleteContents();e.collapse(true);if(c){Xinha._stopEvent(g);return false}}b.getSelection().collapseToEnd()}return true};SmartReplace.prototype.replaceAll=function(){var g=["&quot;",String.fromCharCode(8220),String.fromCharCode(8221),String.fromCharCode(8222),String.fromCharCode(187),String.fromCharCode(171)];var e=["'",String.fromCharCode(8216),String.fromCharCode(8217),String.fromCharCode(8218),String.fromCharCode(8250),String.fromCharCode(8249)];var c=this.editor.getHTML();var h=new RegExp("(\\s|^|>)("+g.join("|")+")(\\S)","g");c=c.replace(h,"$1"+this.openingQuotes+"$3");var b=new RegExp("(\\s|^|>)("+e.join("|")+")(\\S)","g");c=c.replace(b,"$1"+this.openingQuote+"$3");var a=new RegExp("(\\S)("+g.join("|")+")","g");c=c.replace(a,"$1"+this.closingQuotes);var f=new RegExp("(\\S)("+e.join("|")+")","g");c=c.replace(f,"$1"+this.closingQuote);var d=new RegExp("( |&nbsp;)(-)( |&nbsp;)","g");c=c.replace(d," "+String.fromCharCode(8211)+" ");this.editor.setHTML(c)};SmartReplace.prototype.buttonPress=function(c,d){var b=this;if(this.dialog.rootElem.style.display!="none"){return this.dialog.hide()}var e=function(){var f=b.dialog.hide();b.toggleActivity((f.enable)?true:false);if(f.convert){b.replaceAll();b.dialog.getElementById("convert").checked=false}};var a={enable:b.active?"on":"",convert:""};this.show(a,e)};SmartReplace.prototype.onGenerateOnce=function(){this._prepareDialog()};SmartReplace.prototype._prepareDialog=function(){var a=this;var b=this.editor;if(!this.html){Xinha._getback(Xinha.getPluginDir("SmartReplace")+"/dialog.html",function(c){a.html=c;a._prepareDialog()});return}this.dialog=new Xinha.Dialog(b,this.html,"SmartReplace",{},{modal:false});this.dialog.attachToPanel("top");this.dialog.getElementById("enable").onchange=function(){a.toggleActivity(this.checked)};this.dialog.getElementById("convert").onchange=function(){a.dialog.getElementById("ok").style.display=(this.checked)?"":"none"};this.dialog.getElementById("ok").onclick=function(){a.replaceAll();a.dialog.getElementById("convert").checked=false;this.style.display="none"};this.ready=true};SmartReplace.prototype.show=function(a){if(!this.ready){var b=this;window.setTimeout(function(){b.show(a,ok,cancel)},100);return}var b=this;this.dialog.show(a);this.dialog.onresize()};