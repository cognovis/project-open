<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Upgrading OpenACS</title><meta name="generator" content="DocBook XSL Stylesheets V1.64.1"><link rel="home" href="index.html" title="OpenACS Core Documentation"><link rel="up" href="upgrade.html" title="Chapter 5. Upgrading"><link rel="previous" href="upgrade-overview.html" title="Overview"><link rel="next" href="upgrade-openacs-files.html" title="Upgrading the OpenACS files"><link rel="stylesheet" href="openacs.css" type="text/css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><a href="http://openacs.org"><img src="/doc/images/alex.jpg" border="0" alt="Alex logo"></a><table width="100%" summary="Navigation header" border="0"><tr><td width="20%" align="left"><a accesskey="p" href="upgrade-overview.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Upgrading</th><td width="20%" align="right"> <a accesskey="n" href="upgrade-openacs-files.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-openacs"></a>Upgrading OpenACS</h2></div></div><div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-4.5-to-4.6"></a>Upgrading 4.5 or higher to 4.6.3</h3></div></div><div></div></div><a class="indexterm" name="id2525991"></a><p>The required platform for OpenACS 4.6 is the same as
      4.5, with the exception of OpenFTS.  OpenACS 4.6 and later require OpenFTS 0.3.2 for full text search on PostGreSQL.  If you have OpenFTS 0.2, you'll need to upgrade.  </p><p>If upgrading from 4.2, you need to manually run acs-kernel/sql/postgres/upgrade-4.2-4.5.sql.  See <a href="http://openacs.org/bugtracker/openacs/bug?bug_number=632" target="_top">Bug #632</a></p><div class="itemizedlist"><ul type="circle"><li style="list-style-type: circle"><p>A computer with OpenACS 4.5.</p></li><li style="list-style-type: circle"><p><a href="http://openacs.org/projects/openacs/download/" target="_top">OpenACS 4.6 tarball</a> or CVS checkout/export.</p></li><li style="list-style-type: circle"><p>Required for Full Text Search on PostgreSQL: <a href="http://openfts.sourceforge.net" target="_top">OpenFTS 0.3.2</a></p></li></ul></div><div class="orderedlist"><ol type="1"><li><p><b>Make a Backup. </b>Back up the database and file system (see <a href="snapshot-backup.html" title="Manual backup and recovery">the section called &#8220;Manual backup and recovery&#8221;</a>).</p></li><li><p><b>OPTIONAL: Upgrade OpenFTS. </b><a href="upgrade-supporting.html#upgrade-openfts-0.2-to-0.3.2" title="Upgrading OpenFTS from 0.2 to 0.3.2">the section called &#8220;Upgrading OpenFTS from 0.2 to 0.3.2&#8221;</a></p></li><li><p>
            Stop the server
          </p><pre class="screen">[root root]# <b class="userinput"><tt>svc -d /service/<span class="replaceable"><span class="replaceable">service0</span></span></tt></b></pre></li><li><p><b>Upgrade the file system. </b><a href="upgrade-openacs-files.html" title="Upgrading the OpenACS files">the section called &#8220;Upgrading the OpenACS files&#8221;</a></p></li><li><p>
            <span class="strong">Start the server</span>
          </p><pre class="screen">[root root]# <b class="userinput"><tt>svc -u /service/<span class="replaceable"><span class="replaceable">service0</span></span></tt></b></pre></li><li><p><a name="upgrade-with-apm"></a><b>Use APM to upgrade the database. </b></p><div class="orderedlist"><ol type="a"><li><p>Browse to the package manager, <tt class="computeroutput">http://<span class="replaceable"><span class="replaceable">yourserver</span></span>/acs-admin/apm</tt>.</p></li><li><p>Click <tt class="computeroutput"><span class="guilabel"><span class="guilabel">Install packages.</span></span></tt></p></li><li><p>Select the packages you want to install.  This should
              be everything that says
              <tt class="computeroutput">upgrade</tt>, plus any new
              packages you want.  It's safest to upgrade the kernel by
              itself, and then come back and upgrade the rest of the
              desired packages in a second pass.</p></li><li><p>On the next screen, click <tt class="computeroutput"><span class="guibutton"><span class="guibutton">Install Packages</span></span></tt></p></li><li><p>When prompted, restart the server:</p><pre class="screen">[root root]# <b class="userinput"><tt>restart-aolserver <span class="replaceable"><span class="replaceable">service0</span></span></tt></b></pre></li><li><p>Wait a minute, then browse to the package manager, <tt class="computeroutput">http://<span class="replaceable"><span class="replaceable">yourserver</span></span>/acs-admin/apm</tt>.</p></li><li><p>Check that the kernel upgrade worked by clicking <tt class="computeroutput"><span class="guilabel"><span class="guilabel">All</span></span></tt> and making sure that <tt class="computeroutput">acs-kernel</tt> version is 5.1.0d1.</p></li></ol></div></li><li><p><b>Rollback. </b>If anything goes wrong, <a href="snapshot-backup.html#recovery">roll back</a> to the backup snapshot.</p></li></ol></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-4.6.3-to-5"></a>Upgrading OpenACS 4.6.3 to 5.0</h3></div></div><div></div></div><div class="itemizedlist"><ul type="disc"><li><p><b>Oracle. </b>Not yet documented.  It should be possible to upgrade via the APM just as when upgrading to 4.6.3.</p></li><li><p><b>PostGreSQL. </b>You must use PostGreSQL 7.3.x or newer to upgrade OpenACS beyond 4.6.3.  See <a href="upgrade-supporting.html#upgrade-postgres-7.2-to-7.3" title="Upgrading from PostGreSQL 7.2 to 7.3">Upgrade PostGreSQL to 7.3</a>; <a href="individual-programs.html#compatibility-matrix" title="Table 2.2. Version Compatibility Matrix">Table 2.2, &#8220;Version Compatibility Matrix&#8221;</a>
            </p><div class="orderedlist"><ol type="1"><li><p><a href="snapshot-backup.html" title="Manual backup and recovery">Back up the database and file system.</a></p></li><li><p><b>Upgrade the file system for packages/acs-kernel. </b><a href="upgrade-openacs-files.html" title="Upgrading the OpenACS files">the section called &#8220;Upgrading the OpenACS files&#8221;</a></p></li><li><p>Upgrade the kernel manually. (There is a script to do most of the rest: <a href="http://cvs.openacs.org/cvs/openacs-4/contrib/misc/upgrade_4.6_to_5.0.sh?only_with_tag=HEAD" target="_top">/contrib/misc/upgrade_4.6_to_5.0.sh on HEAD</a>).  You'll still have to do a lot of stuff manually, but automated trial and error is much more fun.)</p><pre class="screen">[root root]# <b class="userinput"><tt>su - <span class="replaceable"><span class="replaceable">service0</span></span></tt></b>
[service0 aolserver]$ <b class="userinput"><tt>cd /var/lib/aolserver/ <span class="replaceable"><span class="replaceable">service0</span></span>/packages/acs-kernel/sql/postgresql/upgrade</tt></b></pre><p>
                Manually execute each of the upgrade scripts in sequence, either from within psql or from the command line with commands such as <tt class="computeroutput"><b class="userinput"><tt>psql -f upgrade-4.6.3-4.6.4.sql  <span class="replaceable"><span class="replaceable">service0</span></span></tt></b></tt>.  Run the scripts in this order (order is tentative, not verified):
              </p><pre class="programlisting">psql -f upgrade-4.6.3-4.6.4.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-4.6.4-4.6.5.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-4.6.5-4.6.6.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-4.7d-4.7.2d.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-4.7.2d-5.0d.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0d-5.0d2.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0d2-5.0d3.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0d6-5.0d7.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0d7-5.0d9.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0d11-5.0d12.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0.0a4-5.0.0a5.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0.0b1-5.0.0b2.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0.0b2-5.0.0b3.sql <span class="replaceable"><span class="replaceable">service0</span></span>
psql -f upgrade-5.0.0b3-5.0.0b4.sql <span class="replaceable"><span class="replaceable">service0</span></span></pre></li><li><p>Upgrade ACS Service Contracts manually:</p><pre class="screen">[service0 aolserver]$ <b class="userinput"><tt>cd /var/lib/aolserver/ <span class="replaceable"><span class="replaceable">service0</span></span>/packages/acs-service-contracts/sql/postgresql/upgrade</tt></b>
psql -f upgrade-4.7d2-4.7d3.sql <span class="replaceable"><span class="replaceable">service0</span></span>
</pre></li><li><p>Load acs-authentication data model.</p><pre class="screen"><b class="userinput"><tt>psql -f /var/lib/aolserver/<span class="replaceable"><span class="replaceable">service0</span></span>/openacs-5/packages/acs-authentication/sql/postgresql/acs-authentication-create.sql <span class="replaceable"><span class="replaceable">service0</span></span></tt></b></pre></li><li><p>Load acs-lang data model.</p><pre class="screen"><b class="userinput"><tt>psql -f /var/lib/aolserver/<span class="replaceable"><span class="replaceable">service0</span></span>/packages/acs-lang/sql/postgresql/acs-lang-create.sql <span class="replaceable"><span class="replaceable">service0</span></span></tt></b></pre></li><li><p>(This step may overlap with the two previous steps, but I think it's harmless?) Create a file which will be executed on startup which takes care of a few issues with authentication and internationalization: create <span class="replaceable"><span class="replaceable">service0</span></span>/tcl/zzz-postload.tcl containing:</p><pre class="programlisting">if {![apm_package_installed_p acs-lang]} {
apm_package_install -enable -mount_path acs-lang [acs_root_dir]/packages/acs-lang/acs-lang.info
lang::catalog::import -locales [list "en_US"]
}

if {![apm_package_installed_p acs-authentication]} {
apm_package_install -enable [acs_root_dir]/packages/acs-authentication/acs-authentication.info
apm_parameter_register "UsePasswordWidgetForUsername" \
"Should we hide what the user types in the username
field, the way we do with the password field? Set
this to 1 if you are using sensitive information
such as social security number for username." \
acs-kernel 0 number \
security 1 1
parameter::set_value -package_id [ad_acs_kernel_id] -parameter UsePasswordWidgetForUsername -value 0
}</pre></li><li><p>If you can login, visit /acs-admin/apm and upgrade acs-kernel and acs-service-contract and uncheck the data model scripts. Restart. If everything is still working, make another backup of the database.
              </p></li><li><p>Upgrade other packages <a href="upgrade-openacs.html#upgrade-with-apm">via the APM</a></p></li></ol></div><p>
          See also these forum posts: <a href="http://openacs.org/forums/message-view?message_id=143497" target="_top">Forum OpenACS Development: 4.6.3 upgrade to 5-HEAD: final results</a>, <a href="http://openacs.org/forums/message-view?message_id=152200" target="_top">OpenACS 5.0 Upgrade Experiences</a>.</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-5-0-dot"></a>Upgrading 5.0.0 to 5.0.x</h3></div></div><div></div></div><div class="itemizedlist"><ul type="disc"><li><p><b>Upgrading a stock site. </b>If you have no custom code, and your site is not in a CVS repository, upgrade with these steps:</p><div class="orderedlist"><ol type="1"><li><p>Go to <a href="/acs-admin/install" target="_top">/acs-admin/install/</a> and click "Upgrade Your System" in "Install from OpenACS Repository"</p></li><li><p>Select all of the packages you want to upgrade and proceed</p></li><li><p>After upgrade is complete, restart the server as indicated.</p></li><li><p>If you are using locales other than en_US, go to acs-lang/admin and "Import all Messages" to load the new translated messages.  Your local translations, if any, will take precedence over imported translations.</p></li></ol></div></li><li><p><b>Upgrading a Custom or CVS site. </b>If you have no custom code, and your site is not in a CVS repository, upgrade with these steps:</p><div class="orderedlist"><ol type="1"><li><p><b>Upgrade the file system for all packages in use. </b><a href="upgrade-openacs-files.html" title="Upgrading the OpenACS files">the section called &#8220;Upgrading the OpenACS files&#8221;</a></p></li><li><p>Go to <a href="/acs-admin/install" target="_top">/acs-admin/install/</a> and click "Upgrade Your System" in "Install from local file system"</p></li><li><p>Select all of the packages you want to upgrade and proceed</p></li><li><p>After upgrade is complete, restart the server as indicated.</p></li><li><p>If you are using locales other than en_US, go to acs-lang/admin and "Import all Messages" to load the new translated messages.  Your local translations, if any, will take precedence over imported translations.</p></li></ol></div></li></ul></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="upgrade-overview.html">Prev</a> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right"> <a accesskey="n" href="upgrade-openacs-files.html">Next</a></td></tr><tr><td width="40%" align="left">Overview </td><td width="20%" align="center"><a accesskey="u" href="upgrade.html">Up</a></td><td width="40%" align="right"> Upgrading the OpenACS files</td></tr></table><hr><address><a href="mailto:docs@openacs.org">docs@openacs.org</a></address></div><a name="comments"></a><center><a href="http://openacs.org/doc/upgrade-openacs.html#comments">View comments on this page at openacs.org</a></center></body></html>
